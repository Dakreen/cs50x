Memory in C ‚Äî Stack vs Heap


---

1. What is Memory?

When a C program runs, it uses memory (RAM) to store:

Code ‚Üí the program instructions.

Data ‚Üí variables, arrays, strings.

Metadata ‚Üí function calls, return addresses.


This memory is divided into different regions, each with its own rules.


---

2. The Stack

Automatically managed by the compiler.

Stores local variables, function parameters, and return addresses.

Memory is released automatically when the function exits.

Very fast, but limited in size (a few MB).


Example:

void foo() {
    int x = 10;          // stored on stack
    int arr[3] = {1,2,3}; // stored on stack
} // x and arr are destroyed here

‚ö†Ô∏è Risks:

Stack overflow (too much recursion or huge arrays).

Cannot dynamically resize arrays.



---

3. The Heap

Manually managed by the programmer.

Memory allocated with malloc, calloc, realloc.

Larger than stack, can persist until freed.

Slower access, because the system has to manage allocations.


Example:

void foo() {
    int *list = malloc(3 * sizeof(int));  // allocated on heap
    list[0] = 42;
    free(list); // must be freed manually
}

‚ö†Ô∏è Risks:

Memory leaks ‚Üí forgetting to free.

Dangling pointers ‚Üí using freed memory.

Double free ‚Üí freeing the same block twice.



---

4. Stack vs Heap ‚Äî Quick Comparison

Feature	Stack ü•û	Heap üèóÔ∏è

Managed by	Compiler (automatic)	Programmer (malloc/free)
Size	Small, fixed	Large, flexible
Lifetime	Ends when function ends	Until manually freed
Speed	Very fast	Slower
Typical use	Local vars, small arrays	Dynamic data structures
Risks	Overflow	Leaks, dangling, double free



---

5. Memory Layout

+-----------------------+
|  Code (program text)  |  <- instructions
+-----------------------+
|  Global variables     |  <- static storage
+-----------------------+
|        Heap           |  <- grows upward
|   (malloc/free)       |
+-----------------------+
|        Stack          |  <- grows downward
|   (local vars)        |
+-----------------------+


---

6. Cybersecurity Angle

Stack ‚Üí target of buffer overflows.

Heap ‚Üí target of use-after-free, memory corruption, heap spraying.

Many vulnerabilities in C/C++ come from poor memory management.



---

‚úÖ In short:

Stack = fast, temporary, automatic.

Heap = flexible, persistent, manual.

A good programmer (and security analyst) must understand both.
